<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="è¯—å¥ è¯—å è¯—äºº">
    <ul class="suggestions">
      <li>è¾“å…¥è¯å¥ï¼Œæ‰¾ä¸€é¦–è¯—</li>
      <li>æˆ–è€…è¾“å…¥è¯—å</li>
      <li>æˆ–è€…è¾“å…¥è¯—äºº</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/soyaine/81399bb2b24ca1bb5313e1985533c640/raw/bdf7df2cbcf70706c4a5e51a7dfb8c933ed78878/TangPoetry.json';

const verse = [];
// å‘é€è¯·æ±‚ï¼Œå¹¶æŠŠæ•°æ®å¡«å……åˆ°æ•°ç»„
fetch(endpoint)
    .then(blob => blob.json())
    .then(data => verse.push(...data));
console.log(verse);

// åŒ¹é…è¾“å…¥çš„å‡½æ•°
// 1:è¿ç”¨ filter() è¿‡æ»¤æ•°ç»„æ•°æ®
// 2ï¼šåˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ„é€ è¿‡æ»¤æ¡ä»¶
function findMatches(wordToMatch, verse) {
  return verse.filter(poet => {
      const regex = new RegExp(wordToMatch, 'gi');
      const author = poet.detail_author.join('');
      return poet.detail_text.match(regex) || poet.title.match(regex) || author.match(regex);
  });
}
// å±•ç¤ºåŒ¹é…ç»“æœçš„å‡½æ•°
// 1:è·å–åŒ¹é…æ•°æ®
// 2:æ›¿æ¢å…³é”®è¯æ”¾å…¥é«˜äº®çš„æ ‡ç­¾
// 3:æ„é€  HTML æ ‡ç­¾æ•°æ®
// 4:å°†åŒ¹é…å€¼çš„ HTML æ ‡ç­¾æ”¾å…¥ <ul> ä¸­
function displayMatches() {
  const matchesArray = findMatches(this.value, verse);
  const regex = new RegExp(this.value, 'gi');
  const html = matchesArray.map(poet => {
      // æ›¿æ¢é«˜äº®çš„æ ‡ç­¾
      const text = poet.detail_text.replace(regex, `<span class="hl">${ this.value }</span>`);
      const title = poet.title.replace(regex, `<span class="hl">${ this.value }</span>`);
      // æ„é€  HTML å€¼
      return `
				<li>
					<span class="poet">${ text }</span>
					<span class="title">${ title } - ${ poet.detail_author[0] }</span>
				</li>
			`;
  }).join('');
  suggestions.innerHTML = html;
}

const search = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

search.addEventListener('change', displayMatches);
search.addEventListener('keyup', displayMatches);
</script>
  </body>
</html>
